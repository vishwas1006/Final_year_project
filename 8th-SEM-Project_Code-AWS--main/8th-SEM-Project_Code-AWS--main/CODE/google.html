<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CloudConnect - Google Sign In</title>
  <style>
    :root {
      --primary: #232F3E;
      --secondary: #FF9900;
      --light: #f8f9fa;
      --dark: #232F3E;
      --success: #00A1C9;
      --danger: #D13212;
      --border-radius: 8px;
      --box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f2f5 0%, #e6e9ec 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .login-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      width: 100%;
      max-width: 450px;
      overflow: hidden;
      animation: fadeIn 0.5s ease-out;
    }

    .login-header {
      background: linear-gradient(135deg, var(--primary) 0%, #37475A 100%);
      color: white;
      padding: 2rem;
      text-align: center;
      position: relative;
    }

    .logo {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .logo span {
      color: var(--secondary);
    }

    .login-subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 1rem;
    }

    .login-body {
      padding: 2rem;
      text-align: center;
    }

    .login-text {
      margin-bottom: 1.5rem;
      color: #555;
      line-height: 1.6;
    }

    .google-signin-wrapper {
      margin: 1.5rem 0;
      display: flex;
      justify-content: center;
    }

    #google-signin-button {
      transition: transform 0.3s ease;
    }

    .message {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: var(--border-radius);
      background: #f8f9fa;
      color: #333;
      display: none;
      animation: slideUp 0.4s ease-out;
    }

    .message.success {
      background: rgba(0, 161, 201, 0.1);
      color: var(--success);
      border-left: 4px solid var(--success);
    }

    .loading {
      display: none;
      justify-content: center;
      margin: 1.5rem 0;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(35, 47, 62, 0.1);
      border-top: 4px solid var(--secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .user-info {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: var(--border-radius);
      margin-top: 1.5rem;
      text-align: left;
      display: none;
      animation: slideUp 0.4s ease-out;
    }

    .user-info-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 1rem;
      object-fit: cover;
    }

    .user-name {
      font-weight: 600;
      color: var(--dark);
      font-size: 1.2rem;
    }

    .user-email {
      color: #666;
      margin-top: 0.25rem;
    }

    .user-details {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #ddd;
    }

    .detail-item {
      display: flex;
      margin-bottom: 0.5rem;
    }

    .detail-label {
      width: 120px;
      color: #666;
      font-weight: 500;
    }

    .detail-value {
      flex: 1;
      color: #333;
    }

    .continue-button {
      background: var(--secondary);
      color: var(--dark);
      border: none;
      border-radius: var(--border-radius);
      padding: 0.75rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 1.5rem;
      transition: all 0.3s ease;
      display: none;
    }

    .continue-button:hover {
      background: #e68a00;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 153, 0, 0.3);
    }

    .login-footer {
      text-align: center;
      padding: 1.5rem;
      color: #666;
      font-size: 0.9rem;
      border-top: 1px solid #eee;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 500px) {
      .login-container {
        max-width: 100%;
      }
      
      .login-header, .login-body {
        padding: 1.5rem;
      }
    }
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <div class="logo">Cloud<span>Connect</span></div>
      <p class="login-subtitle">AWS Project Portal</p>
    </div>
    
    <div class="login-body">
      <h2>Sign in with Google</h2>
      <p class="login-text">Please sign in with your Google account to access the CloudConnect AWS portal. Your login information is secured with Google authentication.</p>
      
      <div class="loading" id="loading">
        <div class="loading-spinner"></div>
      </div>
      
      <div class="google-signin-wrapper">
        <div id="google-signin-button"></div>
      </div>
      
      <div class="message" id="message"></div>
      
      <div class="user-info" id="user-info">
        <div class="user-info-header">
          <img class="user-avatar" id="user-avatar" src="/api/placeholder/50/50" alt="User Avatar">
          <div>
            <div class="user-name" id="user-name">User Name</div>
            <div class="user-email" id="user-email">user@example.com</div>
          </div>
        </div>
        
        <div class="user-details" id="user-details">
          <!-- User details will be populated here -->
        </div>
      </div>
      
      <button class="continue-button" id="continue-button">Continue to Dashboard</button>
    </div>
    
    <div class="login-footer">
      &copy; 2025 CloudConnect - An AWS-Powered Solution
    </div>
  </div>

  <script>
    // Handle loading states
    const loading = document.getElementById('loading');
    const message = document.getElementById('message');
    const userInfo = document.getElementById('user-info');
    const continueButton = document.getElementById('continue-button');
    
    // Callback function that runs after a user logs in
    function handleCredentialResponse(response) {
      console.log("Authentication successful - processing token...");
      
      // Show loading indicator
      loading.style.display = 'flex';
      
      // Get the JWT token
      const token = response.credential;
      
      try {
        // Parse the JWT and get user details
        const payload = parseJwt(token);
        console.log("User data:", payload);
        
        // Prepare user data to send back to the parent window
        const userData = {
          id: payload.sub,
          name: payload.name,
          email: payload.email,
          picture: payload.picture,
          given_name: payload.given_name,
          family_name: payload.family_name,
          locale: payload.locale,
          token: token
        };
        
        // Display success message
        showMessage("Authentication successful! You'll be redirected shortly.", "success");
        
        // Display user information
        displayUserInfo(userData);
        
        // Show continue button
        continueButton.style.display = 'inline-block';
        
        // Send user data back to the parent window
        if (window.opener && !window.opener.closed) {
          window.opener.postMessage({
            type: 'googleSignIn',
            userData: userData
          }, window.location.origin);
          
          // Auto-close this popup after a delay
          setTimeout(() => {
            window.close();
          }, 3000);
        }
      } catch (error) {
        console.error("Error processing authentication:", error);
        showMessage("Error processing authentication. Please try again.", "error");
      } finally {
        // Hide loading indicator
        loading.style.display = 'none';
      }
    }
    
    // Function to parse JWT token and get user info
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        
        return JSON.parse(jsonPayload);
      } catch (e) {
        console.error("Error parsing JWT:", e);
        throw new Error("Invalid token format");
      }
    }
    
    // Display message to the user
    function showMessage(text, type = '') {
      message.innerHTML = text;
      message.className = 'message';
      if (type) {
        message.classList.add(type);
      }
      message.style.display = 'block';
    }
    
    // Display user information
    function displayUserInfo(user) {
      document.getElementById('user-avatar').src = user.picture || '/api/placeholder/50/50';
      document.getElementById('user-name').textContent = user.name || 'User';
      document.getElementById('user-email').textContent = user.email || '';
      
      const detailsContainer = document.getElementById('user-details');
      detailsContainer.innerHTML = '';
      
      // Add user details
      if (user.given_name) {
        addDetailItem(detailsContainer, 'First Name', user.given_name);
      }
      if (user.family_name) {
        addDetailItem(detailsContainer, 'Last Name', user.family_name);
      }
      if (user.locale) {
        addDetailItem(detailsContainer, 'Locale', user.locale);
      }
      
      userInfo.style.display = 'block';
    }
    
    // Add detail item to container
    function addDetailItem(container, label, value) {
      const item = document.createElement('div');
      item.className = 'detail-item';
      
      const labelElem = document.createElement('div');
      labelElem.className = 'detail-label';
      labelElem.textContent = label + ':';
      
      const valueElem = document.createElement('div');
      valueElem.className = 'detail-value';
      valueElem.textContent = value;
      
      item.appendChild(labelElem);
      item.appendChild(valueElem);
      container.appendChild(item);
    }
    
    // Initialize the Google Sign-In API and render the button
    window.onload = function() {
      // Configure Continue button
      continueButton.addEventListener('click', function() {
        if (window.opener && !window.opener.closed) {
          window.close();
        } else {
          // If not opened as popup, redirect to main page
          window.location.href = 'index.html';
        }
      });
      
      // Initialize Google Sign-In
      google.accounts.id.initialize({
        client_id: "138786390929-3c2mki82mf6sv960a3hn973t0flej5pq.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
      
      google.accounts.id.renderButton(
        document.getElementById("google-signin-button"),
        { 
          theme: "filled_blue",
          size: "large",
          shape: "pill",
          logo_alignment: "center",
          width: 280,
          text: "signin_with"
        }
      );
      
      // Also prompt One Tap UI if appropriate
      google.accounts.id.prompt();
    };
  </script>
</body>
</html>